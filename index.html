<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Текущий контроль — Открытая разработка месторождений</title>

<style>

body{
font-family: Arial;
background:#0f172a;
color:white;
padding:20px;
}

.container{
max-width:800px;
margin:auto;
}

.card{
background:#1e293b;
padding:20px;
border-radius:10px;
margin-bottom:15px;
}

button{
width:100%;
padding:12px;
margin:6px 0;
border:none;
border-radius:8px;
background:#2563eb;
color:white;
font-size:16px;
cursor:pointer;
}

button:hover{
background:#1d4ed8;
}

input{
width:100%;
padding:10px;
border-radius:6px;
border:none;
margin-top:10px;
}

.score{
background:#334155;
padding:10px;
border-radius:8px;
margin-bottom:10px;
}

</style>

</head>
<body>

<div class="container">

<div class="card">

<h2>Текущий контроль</h2>
<p>Открытая разработка месторождений</p>

<input id="name" placeholder="Введите ФИО">

<button onclick="startTest()">Начать тест</button>

<button onclick="showJournal()">Журнал результатов</button>

<button onclick="downloadExcel()">Скачать журнал в Excel</button>

</div>

<div class="card">
<div id="variant"></div>
</div>

<div id="quiz"></div>

</div>

<script>

/* ---------- ПЕРЕМЕННЫЕ ---------- */

let questions=[];
let index=0;
let score=0;
let variant=0;
let student="";
let startTime;

/* ---------- КЛАССИФИКАЦИЯ ---------- */

function getStrength(f){

if(f<=2) return "мягкие породы";
if(f<=5) return "полускальные породы";
return "скальные породы";

}

function getDip(angle){

if(angle<=10) return "пологая залежь";
if(angle<=30) return "наклонная залежь";
if(angle<=55) return "крутонаклонная залежь";
return "крутая залежь";

}

/* ---------- ПЕРЕМЕШИВАНИЕ ---------- */

function shuffle(array){

return [...array].sort(()=>Math.random()-0.5);

}

function shuffleAnswers(q){

let correctAnswer=q.a[q.correct];

let shuffled=shuffle(q.a);

let newCorrect=shuffled.indexOf(correctAnswer);

return {q:q.q,a:shuffled,correct:newCorrect};

}

/* ---------- ГЕНЕРАЦИЯ 10 УНИКАЛЬНЫХ ВОПРОСОВ ---------- */

function generateQuestions(name,f,angle){

let strength=getStrength(f);
let dip=getDip(angle);

let list=[

{
q:`${name} имеет коэффициент крепости f = ${f}. Определите группу пород.`,
a:["мягкие породы","полускальные породы","скальные породы","сыпучие породы"],
correct: strength=="мягкие породы"?0:strength=="полускальные породы"?1:2
},

{
q:`${name} имеет угол падения ${angle}°. Определите тип залежи.`,
a:["пологая залежь","наклонная залежь","крутонаклонная залежь","крутая залежь"],
correct: dip=="пологая залежь"?0:dip=="наклонная залежь"?1:dip=="крутонаклонная залежь"?2:3
},

{
q:`Основным объектом разработки месторождения ${name} является:`,
a:["залежь полезного ископаемого","уступ карьера","вскрышные породы","отвал пород"],
correct:0
},

{
q:`Коэффициент вскрыши определяется как отношение:`,
a:[
"объема вскрышных пород к объему полезного ископаемого",
"объема полезного ископаемого к объему вскрышных пород",
"глубины карьера к длине карьера",
"ширины карьера к глубине карьера"
],
correct:0
},

{
q:`Подготовительный период включает:`,
a:[
"подготовку месторождения к разработке",
"выполнение добычных работ",
"ликвидацию карьера",
"транспортирование пород"
],
correct:0
},

{
q:`Эксплуатационный период включает:`,
a:[
"вскрышные и добычные работы",
"подготовительные работы",
"ликвидационные работы",
"проектные работы"
],
correct:0
},

{
q:`Траншея предназначена для:`,
a:[
"вскрытия месторождения",
"размещения транспорта",
"складирования пород",
"размещения оборудования"
],
correct:0
},

{
q:`Уступ представляет собой:`,
a:[
"ступенчатую часть массива",
"часть отвала",
"часть поверхности",
"часть транспорта"
],
correct:0
},

{
q:`Транспорт используется для:`,
a:[
"перемещения горной массы",
"разрушения массива",
"подготовки уступа",
"бурения скважин"
],
correct:0
},

{
q:`Кондиции, устанавливаемые при проектировании, называются:`,
a:[
"проектные кондиции",
"геологические кондиции",
"эксплуатационные кондиции",
"временные кондиции"
],
correct:0
}

];

return list.map(shuffleAnswers);

}

/* ---------- 12 ВАРИАНТОВ ---------- */

let variants={

1: generateQuestions("Уголь",3,5),
2: generateQuestions("Уголь",3,8),

3: generateQuestions("Железная руда",7,25),
4: generateQuestions("Железная руда",7,70),

5: generateQuestions("Медь",8,65),
6: generateQuestions("Медь",8,25),

7: generateQuestions("Золото",9,40),

8: generateQuestions("Бокситы",4,10),

9: generateQuestions("Фосфориты",1.5,3),

10: generateQuestions("Хром",10,75),

11: generateQuestions("Марганец",4,20),

12: generateQuestions("Известняк",1.5,4)

};

/* ---------- НАЧАЛО ---------- */

function startTest(){

student=document.getElementById("name").value;

if(student==""){
alert("Введите ФИО");
return;
}

variant=Math.floor(Math.random()*12)+1;

questions=variants[variant];

startTime=new Date();

document.getElementById("variant").innerHTML="<b>Ваш вариант: "+variant+"</b>";

index=0;
score=0;

showQuestion();

}

/* ---------- ПОКАЗ ---------- */

function showQuestion(){

if(index>=questions.length){

finishTest();
return;

}

let q=questions[index];

let html="<div class='card'>"+
"<div class='score'>Баллы: "+score+"/100</div>"+
"<h3>Вопрос "+(index+1)+" из 10</h3>"+
"<p>"+q.q+"</p>";

q.a.forEach((a,i)=>{

html+="<button onclick='answer("+i+")'>"+a+"</button>";

});

html+="</div>";

document.getElementById("quiz").innerHTML=html;

}

/* ---------- ОТВЕТ ---------- */

function answer(i){

if(i==questions[index].correct) score+=10;

index++;

showQuestion();

}

/* ---------- ЗАВЕРШЕНИЕ ---------- */

function finishTest(){

let end=new Date();

let result={

name:student,
variant:variant,
score:score,
date:end.toLocaleString(),
time:Math.round((end-startTime)/1000)

};

saveResult(result);

document.getElementById("quiz").innerHTML=
"<div class='card'>"+
"<h2>Тест завершен</h2>"+
"<p>ФИО: "+result.name+"</p>"+
"<p>Вариант: "+result.variant+"</p>"+
"<p>Баллы: "+result.score+"/100</p>"+
"<p>Время: "+result.time+" сек</p>"+
"</div>";

}

/* ---------- ЖУРНАЛ ---------- */

function saveResult(r){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

journal.push(r);

localStorage.setItem("journal",JSON.stringify(journal));

}

function showJournal(){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

let html="<div class='card'><h2>Журнал результатов</h2>";

journal.forEach((r,i)=>{

html+="<p>"+(i+1)+". "+r.name+" | вариант "+r.variant+" | "+r.score+" баллов | "+r.date+"</p>";

});

html+="</div>";

document.getElementById("quiz").innerHTML=html;

}

/* ---------- EXCEL ---------- */

function downloadExcel(){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

if(journal.length===0){
alert("Журнал пуст");
return;
}

let csv="ФИО;Вариант;Баллы;Дата;Время (сек)\n";

journal.forEach(r=>{

csv+=`${r.name};${r.variant};${r.score};${r.date};${r.time}\n`;

});

let blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});

let link=document.createElement("a");

link.href=URL.createObjectURL(blob);

link.download="Журнал_ОГР.csv";

link.click();

}

</script>

</body>
</html>
