<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Текущий контроль ОГР</title>

<style>

body{
font-family: Arial;
background:#0f172a;
color:white;
padding:20px;
}

.container{
max-width:800px;
margin:auto;
}

.card{
background:#1e293b;
padding:20px;
border-radius:10px;
margin-bottom:15px;
}

button{
width:100%;
padding:12px;
margin:6px 0;
border:none;
border-radius:8px;
background:#2563eb;
color:white;
font-size:16px;
}

button:hover{
background:#1d4ed8;
}

input{
width:100%;
padding:10px;
border-radius:6px;
border:none;
margin-top:10px;
}

.score{
background:#334155;
padding:10px;
border-radius:8px;
margin-bottom:10px;
}

</style>

</head>
<body>

<div class="container">

<div class="card">

<h2>Текущий контроль</h2>
<p>Открытая разработка месторождений</p>

<input id="name" placeholder="Введите ФИО">

<button onclick="startTest()">Начать тест</button>

<button onclick="showJournal()">Журнал результатов</button>

</div>

<div class="card">
<div id="variant"></div>
</div>

<div id="quiz"></div>

</div>

<script>

/* ---------- 12 ВАРИАНТОВ ---------- */

let variants = {

1: generateVariant("Уголь",3,8),
2: generateVariant("Уголь",3,6),

3: generateVariant("Железная руда",7,20),
4: generateVariant("Железная руда",7,70),

5: generateVariant("Медь",8,65),
6: generateVariant("Медь",8,25),

7: generateVariant("Золото",9,0,"сложная"),

8: generateVariant("Бокситы",4,8),

9: generateVariant("Фосфориты",1.5,3),

10: generateVariant("Хром",10,75),

11: generateVariant("Марганец",4,20),

12: generateVariant("Известняк",1.5,4)

};

/* ---------- ГЕНЕРАЦИЯ ВАРИАНТА ---------- */

function generateVariant(name,f,angle,typeOverride){

let type = "";

if(typeOverride){
type = typeOverride;
}
else if(angle<=10) type="пологая";
else if(angle<=30) type="наклонная";
else if(angle<=55) type="крутонаклонная";
else type="крутая";

let strength = "";

if(f<=2) strength="мягкие";
else if(f<=5) strength="полускальные";
else strength="скальные";

return shuffleAnswersList([

{
q:`${name} имеет коэффициент крепости f = ${f}. Определите тип породы.`,
a:["мягкие породы","полускальные породы","скальные породы","сыпучие породы"],
correct: strength=="мягкие"?0:strength=="полускальные"?1:2
},

{
q:`${name} имеет угол падения ${angle}°. Определите тип залежи.`,
a:["пологая залежь","наклонная залежь","крутонаклонная залежь","крутая залежь"],
correct: type=="пологая"?0:type=="наклонная"?1:type=="крутонаклонная"?2:3
},

{
q:`Основным объектом разработки при добыче ${name} является:`,
a:["залежь полезного ископаемого","вскрышная толща пород","рабочий уступ карьера","транспортная площадка"],
correct:0
},

{
q:`Коэффициент вскрыши при разработке ${name} определяется как:`,
a:[
"отношение объема вскрышных пород к объему полезного ископаемого",
"отношение объема полезного ископаемого к объему вскрышных пород",
"отношение глубины карьера к длине карьера",
"отношение ширины карьера к глубине карьера"
],
correct:0
},

{
q:`Подготовительный период разработки месторождения ${name} включает:`,
a:[
"подготовку месторождения к разработке",
"выполнение добычных работ",
"выполнение рекультивации",
"выполнение ликвидации"
],
correct:0
},

{
q:`Эксплуатационный период разработки ${name} включает:`,
a:[
"вскрышные и добычные работы",
"подготовительные работы",
"ликвидационные работы",
"рекультивационные работы"
],
correct:0
},

{
q:`Траншея при разработке ${name} предназначена для:`,
a:[
"вскрытия месторождения",
"складирования пород",
"размещения оборудования",
"размещения транспорта"
],
correct:0
},

{
q:`Уступ при разработке ${name} представляет собой:`,
a:[
"ступенчатую часть массива",
"часть отвала пород",
"часть транспортной площадки",
"часть поверхности месторождения"
],
correct:0
},

{
q:`Транспорт при разработке ${name} предназначен для:`,
a:[
"перемещения горной массы",
"разрушения горных пород",
"подготовки уступов",
"бурения скважин"
],
correct:0
},

{
q:`Кондиции при разработке ${name}, устанавливаемые при проектировании, называются:`,
a:[
"проектные кондиции",
"геологические кондиции",
"эксплуатационные кондиции",
"временные кондиции"
],
correct:0
}

]);

}

/* ---------- ПЕРЕМЕШИВАНИЕ ---------- */

function shuffle(array){
return [...array].sort(()=>Math.random()-0.5);
}

function shuffleAnswersList(list){
return list.map(q=>shuffleAnswers(q));
}

function shuffleAnswers(q){

let correctAnswer = q.a[q.correct];
let shuffled = shuffle(q.a);
let newCorrect = shuffled.indexOf(correctAnswer);

return {q:q.q,a:shuffled,correct:newCorrect};

}

/* ---------- ПЕРЕМЕННЫЕ ---------- */

let questions=[];
let index=0;
let score=0;
let variant=0;
let student="";
let startTime;

/* ---------- НАЧАЛО ---------- */

function startTest(){

student=document.getElementById("name").value;

if(student==""){
alert("Введите ФИО");
return;
}

variant=Math.floor(Math.random()*12)+1;

questions=variants[variant];

startTime=new Date();

document.getElementById("variant").innerHTML="<b>Ваш вариант: "+variant+"</b>";

index=0;
score=0;

showQuestion();

}

/* ---------- ВОПРОС ---------- */

function showQuestion(){

if(index>=questions.length){
finishTest();
return;
}

let q=questions[index];

let html="<div class='card'>"+
"<div class='score'>Баллы: "+score+"/100</div>"+
"<h3>Вопрос "+(index+1)+" из 10</h3>"+
"<p>"+q.q+"</p>";

q.a.forEach((a,i)=>{
html+="<button onclick='answer("+i+")'>"+a+"</button>";
});

html+="</div>";

document.getElementById("quiz").innerHTML=html;

}

/* ---------- ОТВЕТ ---------- */

function answer(i){

if(i==questions[index].correct) score+=10;

index++;

showQuestion();

}

/* ---------- ЗАВЕРШЕНИЕ ---------- */

function finishTest(){

let end=new Date();

let result={
name:student,
variant:variant,
score:score,
date:end.toLocaleString(),
time:Math.round((end-startTime)/1000)
};

saveResult(result);

document.getElementById("quiz").innerHTML=
"<div class='card'>"+
"<h2>Тест завершен</h2>"+
"<p>ФИО: "+result.name+"</p>"+
"<p>Вариант: "+result.variant+"</p>"+
"<p>Баллы: "+result.score+"/100</p>"+
"<p>Время: "+result.time+" сек</p>"+
"</div>";

}

/* ---------- ЖУРНАЛ ---------- */

function saveResult(r){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

journal.push(r);

localStorage.setItem("journal",JSON.stringify(journal));

}

function showJournal(){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

let html="<div class='card'><h2>Журнал результатов</h2>";

journal.forEach((r,i)=>{
html+="<p>"+(i+1)+". "+r.name+" | вариант "+r.variant+" | "+r.score+" баллов | "+r.date+"</p>";
});

html+="</div>";

document.getElementById("quiz").innerHTML=html;

}

</script>

</body>
</html>
