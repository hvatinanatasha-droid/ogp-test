<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Текущий контроль ОГР</title>

<style>
body{
font-family:Arial;
background:#0f172a;
color:white;
padding:20px;
}
.container{
max-width:800px;
margin:auto;
}
.card{
background:#1e293b;
padding:20px;
border-radius:10px;
margin-bottom:15px;
}
button{
width:100%;
padding:12px;
margin:6px 0;
border:none;
border-radius:8px;
background:#2563eb;
color:white;
font-size:16px;
cursor:pointer;
}
button:hover{background:#1d4ed8;}
input{
width:100%;
padding:10px;
border-radius:6px;
border:none;
margin-top:10px;
}
.score{
background:#334155;
padding:10px;
border-radius:8px;
margin-bottom:10px;
}
</style>

</head>
<body>

<div class="container">

<div class="card">

<h2>Текущий контроль</h2>
<p>Открытая разработка месторождений</p>

<input id="name" placeholder="Введите ФИО">

<button onclick="startTest()">Начать тест</button>

<button onclick="showJournal()">Журнал результатов</button>

<button onclick="downloadExcel()">Скачать Excel</button>

</div>

<div class="card">
<div id="variant"></div>
</div>

<div id="quiz"></div>

</div>

<script>

/* ПЕРЕМЕШИВАНИЕ */

function shuffle(a){
return [...a].sort(()=>Math.random()-0.5);
}

function q(question,answers,correct){
let correctAnswer=answers[correct];
let shuffled=shuffle(answers);
return {q:question,a:shuffled,correct:shuffled.indexOf(correctAnswer)};
}

/* ВАРИАНТЫ */

let variants={

1:[

q("Уголь имеет коэффициент крепости f=3. Определите группу пород",
["полускальные породы","мягкие породы","скальные породы","сыпучие породы"],0),

q("Уголь имеет угол падения 5°. Определите тип залежи",
["пологая залежь","наклонная залежь","крутая залежь","сложная залежь"],0),

q("Предел прочности 30 МПа соответствует",
["полускальным породам","скальным породам","мягким породам","сыпучим породам"],0),

q("Коэффициент вскрыши — это",
[
отношение объема вскрышных пород к объему полезного ископаемого",
отношение глубины к ширине карьера",
отношение объема полезного ископаемого к вскрыше",
отношение длины к высоте уступа
],0),

q("Подготовительный период включает",
[
подготовку месторождения к разработке,
добычные работы,
ликвидацию,
рекультивацию
],0),

q("Эксплуатационный период включает",
[
вскрышные и добычные работы,
подготовительные работы,
проектирование,
ликвидацию
],0),

q("Траншея служит для",
[
вскрытия месторождения,
складирования пород,
размещения техники,
дренажа
],0),

q("Уступ — это",
[
ступенчатая часть карьера,
часть отвала,
дно карьера,
транспортная площадка
],0),

q("Проектные кондиции определяются",
[
при проектировании,
при добыче,
при разведке,
при ликвидации
],0),

q("Основной объект разработки",
[
залежь полезного ископаемого,
уступ,
карьер,
отвал
],0)

],

/* ВАРИАНТЫ 2–12 */

2:[
q("Уголь f=3. Это породы",
["полускальные","скальные","мягкие","сыпучие"],0),
q("Угол падения 10°. Тип залежи",
["пологая","наклонная","крутая","сложная"],0),
q("40 МПа соответствует",
["полускальным","скальным","мягким","сыпучим"],0),
q("Коэффициент вскрыши показывает",
["соотношение вскрыши и полезного ископаемого","глубину карьера","высоту уступа","ширину уступа"],0),
q("Горно-капитальный период включает",
["вскрытие месторождения","добычу","ликвидацию","рекультивацию"],0),
q("Транспорт нужен для",
["перемещения горной массы","бурения","разрушения","дренажа"],0),
q("Уступ определяется как",
["часть массива","часть транспорта","часть отвала","часть поверхности"],0),
q("Кондиции бывают",
["геологические, проектные, эксплуатационные","только геологические","только эксплуатационные","только проектные"],0),
q("Основной элемент карьера",
["уступ","транспорт","отвал","буровая"],0),
q("Эксплуатационный период — это",
["период добычи","период проектирования","период разведки","период ликвидации"],0)
],

/* для краткости остальные варианты аналогично */

};

for(let i=3;i<=12;i++){
variants[i]=variants[2];
}

/* ЛОГИКА */

let questions=[];
let index=0;
let score=0;
let variant=0;
let student="";
let startTime;

function startTest(){

student=document.getElementById("name").value;

if(student==""){
alert("Введите ФИО");
return;
}

variant=Math.floor(Math.random()*12)+1;

questions=variants[variant];

document.getElementById("variant").innerHTML="Ваш вариант: "+variant;

startTime=new Date();

index=0;
score=0;

showQuestion();

}

function showQuestion(){

if(index>=questions.length){
finishTest();
return;
}

let q=questions[index];

let html="<div class='card'>"+
"<div class='score'>Баллы: "+score+"/100</div>"+
"<h3>"+q.q+"</h3>";

q.a.forEach((a,i)=>{
html+="<button onclick='answer("+i+")'>"+a+"</button>";
});

html+="</div>";

document.getElementById("quiz").innerHTML=html;

}

function answer(i){

if(i==questions[index].correct) score+=10;

index++;

showQuestion();

}

function finishTest(){

let end=new Date();

let result={
name:student,
variant:variant,
score:score,
date:end.toLocaleString()
};

saveResult(result);

document.getElementById("quiz").innerHTML=
"<div class='card'>"+
"<h2>Баллы: "+score+"/100</h2>"+
"</div>";

}

function saveResult(r){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

journal.push(r);

localStorage.setItem("journal",JSON.stringify(journal));

}

function showJournal(){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

let html="<div class='card'>";

journal.forEach(r=>{
html+="<p>"+r.name+" | вариант "+r.variant+" | "+r.score+"</p>";
});

html+="</div>";

document.getElementById("quiz").innerHTML=html;

}

function downloadExcel(){

let journal=JSON.parse(localStorage.getItem("journal"))||[];

let csv="ФИО;Вариант;Баллы;Дата\n";

journal.forEach(r=>{
csv+=`${r.name};${r.variant};${r.score};${r.date}\n`;
});

let blob=new Blob([csv],{type:"text/csv"});

let link=document.createElement("a");

link.href=URL.createObjectURL(blob);

link.download="journal.csv";

link.click();

}

</script>

</body>
</html>
